# -------------------------------------------------------------------------
# transforms.conf
#
# Dragos OT Security for Splunk App
#
# Purpose:
# - Define explicit, minimal, AppInspect-safe transforms
# - Support routing, sourcetype hygiene, and optional normalization
# - NO destructive rewriting of _raw
# - NO field dropping
# - NO mutation of Dragos payloads
#
# Design rules:
# - Dragos data remains authoritative
# - JSON structure is preserved
# - Transforms are only used where Splunk REQUIRES them
# - All logic is deterministic and auditable
# -------------------------------------------------------------------------

###############################################################################
# Sourcetype enforcement (defensive)
#
# These transforms exist ONLY to guarantee correct sourcetype assignment
# in cases where modular input metadata is missing or malformed.
#
# They DO NOT alter event content.
###############################################################################

[set_sourcetype_dragos_assets]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::dragos:assets

[set_sourcetype_dragos_users]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::dragos:users

[set_sourcetype_dragos_notifications]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::dragos:notifications

[set_sourcetype_dragos_vulnerabilities]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::dragos:vulnerabilities

[set_sourcetype_dragos_threats]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::dragos:threats

[set_sourcetype_dragos_malware]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::dragos:malware

[set_sourcetype_dragos_alerts]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::dragos:alerts

[set_sourcetype_dragos_audit]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::dragos:audit

[set_sourcetype_dragos_logs_error]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::dragos:logs:error

[set_sourcetype_dragos_version]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::dragos:version

[set_sourcetype_dragos_system_health]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::dragos:system:health

###############################################################################
# Dragos Portal (Intel) datasets
###############################################################################

[set_sourcetype_dragos_indicators]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::dragos:indicators

[set_sourcetype_dragos_products]
DEST_KEY = MetaData:Sourcetype
REGEX = .
FORMAT = sourcetype::dragos:products

###############################################################################
# Index routing (optional / controlled)
#
# These transforms are ONLY enabled if explicitly referenced
# from props.conf.
###############################################################################

[route_to_dragos_index]
DEST_KEY = _MetaData:Index
REGEX = .
FORMAT = dragos

###############################################################################
# END OF FILE
###############################################################################
