<dashboard version="1.1" theme="light">
  <label>Dragos OT Security â€“ Threat Intelligence</label>
  <description>
    Detection-driven threat intelligence and adversary activity indexed from Dragos OT telemetry.
  </description>

  <!-- Header -->
  <row>
    <panel>
      <html>
        <![CDATA[
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div>
            <h2 style="margin-bottom:4px;">Threat Intelligence</h2>
            <p style="margin-top:0; color:#666;">
              Threat actors, campaigns, malware families, and kill-chain staging derived from Dragos detections.
            </p>
          </div>
          <img src="/static/app/dragos_ot_security/dragos_logo.png"
               alt="Dragos"
               style="height:42px;" />
        </div>
        ]]>
      </html>
    </panel>
  </row>

  <!-- KPIs -->
  <row>
    <panel>
      <title>Active Threat Actors (30d)</title>
      <single>
        <search>
          <query>
            index=dragos sourcetype=dragos:threat_intel
            | stats dc(threat_actor)
          </query>
          <earliest>-30d</earliest>
          <latest>now</latest>
        </search>
      </single>
    </panel>

    <panel>
      <title>Active Campaigns (30d)</title>
      <single>
        <search>
          <query>
            index=dragos sourcetype=dragos:threat_intel
            | stats dc(campaign)
          </query>
          <earliest>-30d</earliest>
          <latest>now</latest>
        </search>
      </single>
    </panel>

    <panel>
      <title>Malware Families (30d)</title>
      <single>
        <search>
          <query>
            index=dragos sourcetype=dragos:threat_intel
            | stats dc(malware_family)
          </query>
          <earliest>-30d</earliest>
          <latest>now</latest>
        </search>
      </single>
    </panel>

    <panel>
      <title>Associated Alerts (30d)</title>
      <single>
        <search>
          <query>
            index=dragos sourcetype=dragos:threat_intel
            | stats sum(associated_alerts) as associated_alerts
          </query>
          <earliest>-30d</earliest>
          <latest>now</latest>
        </search>
        <option name="unit"></option>
      </single>
    </panel>
  </row>

  <!-- Top Threat Actors / Campaigns -->
  <row>
    <panel>
      <title>Top Threat Actors</title>
      <chart>
        <search>
          <query>
            index=dragos sourcetype=dragos:threat_intel
            | stats count as events by threat_actor
            | sort - events
            | head 10
          </query>
          <earliest>-90d</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">bar</option>
      </chart>
    </panel>

    <panel>
      <title>Top Campaigns</title>
      <chart>
        <search>
          <query>
            index=dragos sourcetype=dragos:threat_intel
            | stats count as events by campaign
            | sort - events
            | head 10
          </query>
          <earliest>-90d</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">bar</option>
      </chart>
    </panel>
  </row>

  <!-- Malware / Kill Chain -->
  <row>
    <panel>
      <title>Top Malware Families</title>
      <chart>
        <search>
          <query>
            index=dragos sourcetype=dragos:threat_intel
            | stats count as events by malware_family
            | sort - events
            | head 10
          </query>
          <earliest>-90d</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">bar</option>
      </chart>
    </panel>

    <panel>
      <title>Kill Chain Stage Distribution</title>
      <chart>
        <search>
          <query>
            index=dragos sourcetype=dragos:threat_intel
            | stats count as events by kill_chain_stage
            | sort - events
          </query>
          <earliest>-90d</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>
  </row>

  <!-- ICS Specificity / Confidence -->
  <row>
    <panel>
      <title>ICS Specificity</title>
      <chart>
        <search>
          <query>
            index=dragos sourcetype=dragos:threat_intel
            | stats count as events by ics_specificity
            | sort - events
          </query>
          <earliest>-90d</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>

    <panel>
      <title>Confidence Distribution</title>
      <chart>
        <search>
          <query>
            index=dragos sourcetype=dragos:threat_intel
            | stats count as events by confidence
            | sort - events
          </query>
          <earliest>-90d</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">bar</option>
      </chart>
    </panel>
  </row>

  <!-- Threat Intel Table -->
  <row>
    <panel>
      <title>Threat Intelligence Records</title>
      <table>
        <search>
          <query>
            index=dragos sourcetype=dragos:threat_intel
            | table _time threat_actor campaign malware_family ics_specificity confidence kill_chain_stage associated_alerts
            | sort - _time
          </query>
          <earliest>-90d</earliest>
          <latest>now</latest>
        </search>
        <option name="count">20</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

</dashboard>

