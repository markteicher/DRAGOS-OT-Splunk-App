<dashboard version="1.1" theme="light">
  <label>Dragos OT Security â€“ Assets</label>
  <description>
    OT asset inventory and contextual visibility derived from Dragos telemetry.
  </description>

  <!-- Header -->
  <row>
    <panel>
      <html>
        <![CDATA[
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div>
            <h2 style="margin-bottom:4px;">OT Asset Inventory</h2>
            <p style="margin-top:0; color:#666;">
              Observed OT assets, criticality, and environmental context.
            </p>
          </div>
          <img src="/static/app/dragos_ot_security/dragos_logo.png"
               alt="Dragos"
               style="height:42px;" />
        </div>
        ]]>
      </html>
    </panel>
  </row>

  <!-- KPIs -->
  <row>
    <panel>
      <title>Total Assets</title>
      <single>
        <search>
          <query>
            index=dragos sourcetype=dragos:asset
            | stats dc(asset_id)
          </query>
          <earliest>-30d</earliest>
          <latest>now</latest>
        </search>
      </single>
    </panel>

    <panel>
      <title>Critical Assets</title>
      <single>
        <search>
          <query>
            index=dragos sourcetype=dragos:asset criticality="high"
            | stats count
          </query>
          <earliest>-30d</earliest>
          <latest>now</latest>
        </search>
      </single>
    </panel>

    <panel>
      <title>New Assets (7d)</title>
      <single>
        <search>
          <query>
            index=dragos sourcetype=dragos:asset
            | where first_seen >= relative_time(now(), "-7d")
            | stats count
          </query>
          <earliest>-7d</earliest>
          <latest>now</latest>
        </search>
      </single>
    </panel>

    <panel>
      <title>Active Assets (24h)</title>
      <single>
        <search>
          <query>
            index=dragos sourcetype=dragos:asset
            | where last_seen >= relative_time(now(), "-24h")
            | stats count
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
        </search>
      </single>
    </panel>
  </row>

  <!-- Distribution -->
  <row>
    <panel>
      <title>Assets by Type</title>
      <chart>
        <search>
          <query>
            index=dragos sourcetype=dragos:asset
            | stats count by asset_type
            | sort - count
          </query>
          <earliest>-30d</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>

    <panel>
      <title>Assets by Vendor</title>
      <chart>
        <search>
          <query>
            index=dragos sourcetype=dragos:asset
            | stats count by vendor
            | sort - count
            | head 10
          </query>
          <earliest>-30d</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">bar</option>
      </chart>
    </panel>
  </row>

  <!-- OT Context -->
  <row>
    <panel>
      <title>Assets by Zone</title>
      <chart>
        <search>
          <query>
            index=dragos sourcetype=dragos:asset
            | stats count by zone
            | sort - count
          </query>
          <earliest>-30d</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">bar</option>
      </chart>
    </panel>

    <panel>
      <title>Assets by Site</title>
      <chart>
        <search>
          <query>
            index=dragos sourcetype=dragos:asset
            | stats count by site
            | sort - count
          </query>
          <earliest>-30d</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">bar</option>
      </chart>
    </panel>
  </row>

  <!-- Asset Table -->
  <row>
    <panel>
      <title>Asset Inventory Table</title>
      <table>
        <search>
          <query>
            index=dragos sourcetype=dragos:asset
            | table asset_id asset_name ip_address mac_address vendor model firmware_version asset_type zone site criticality first_seen last_seen
            | sort - last_seen
          </query>
          <earliest>-30d</earliest>
          <latest>now</latest>
        </search>
        <option name="count">20</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

</dashboard>
