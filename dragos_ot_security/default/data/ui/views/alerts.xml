<dashboard version="1.1">
  <label>Dragos OT Security – Alerts</label>

  <!-- ========================= -->
  <!-- HEADER WITH DRAGOS LOGO -->
  <!-- ========================= -->
  <row>
    <panel>
      <html>
        <![CDATA[
        <div style="display:flex; align-items:center; padding:10px 0;">
          <img src="/static/app/dragos_splunk_app/appLogo.png"
               alt="Dragos"
               style="height:48px; margin-right:16px;" />
          <h1 style="margin:0; font-weight:600;">
            Dragos OT Security – Alerts
          </h1>
        </div>
        ]]>
      </html>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- ALERT KPIs -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Total Alerts (24h)</title>
      <single>
        <search>
          <query>
            index=dragos sourcetype=dragos:alerts
            | stats count
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
        </search>
      </single>
    </panel>

    <panel>
      <title>High Severity Alerts</title>
      <single>
        <search>
          <query>
            index=dragos sourcetype=dragos:alerts severity=high
            | stats count
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
        </search>
      </single>
    </panel>

    <panel>
      <title>Confirmed Alerts</title>
      <single>
        <search>
          <query>
            index=dragos sourcetype=dragos:alerts status=confirmed
            | stats count
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
        </search>
      </single>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- ALERTS BY SEVERITY -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Alerts by Severity</title>
      <chart>
        <search>
          <query>
            index=dragos sourcetype=dragos:alerts
            | stats count by severity
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- ALERTS BY PROTOCOL -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Alerts by OT Protocol</title>
      <chart>
        <search>
          <query>
            index=dragos sourcetype=dragos:alerts protocol=*
            | stats count by protocol
            | sort -count
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>

  <!-- ========================= -->
  <!-- DETAILED ALERT TABLE -->
  <!-- ========================= -->
  <row>
    <panel>
      <title>Alert Details</title>
      <table>
        <search>
          <query>
            index=dragos sourcetype=dragos:alerts
            | sort -timestamp
            | table timestamp alert_id alert_name severity confidence status threat_family protocol asset_name
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
        </search>
        <option name="count">20</option>
      </table>
    </panel>
  </row>

</dashboard>
